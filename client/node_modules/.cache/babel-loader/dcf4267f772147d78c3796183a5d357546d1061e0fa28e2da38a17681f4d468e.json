{"ast":null,"code":"import _toConsumableArray from\"D:/Andrew/Documents/GitHub/SpotifyApp/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"D:/Andrew/Documents/GitHub/SpotifyApp/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Andrew/Documents/GitHub/SpotifyApp/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/Andrew/Documents/GitHub/SpotifyApp/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useMemo}from'react';import{useParams}from'react-router-dom';import axios from'axios';import{catchErrors}from'../utils';import{getPlaylistById,getAudioFeaturesForTracks}from'../Spotify';import{TrackList,SectionWrapper,Loader}from'../components';import{StyledHeader,StyledDropdown}from'../styles';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Playlist=function Playlist(){var _useParams=useParams(),id=_useParams.id;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),playlist=_useState2[0],setPlaylist=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),tracksData=_useState4[0],setTracksData=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),tracks=_useState6[0],setTracks=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),audioFeatures=_useState8[0],setAudioFeatures=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),sortValue=_useState10[0],setSortValue=_useState10[1];var sortOptions=['danceability','tempo','energy'];useEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$getPlaylistByI,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return getPlaylistById(id);case 2:_yield$getPlaylistByI=_context.sent;data=_yield$getPlaylistByI.data;setPlaylist(data);setTracksData(data.tracks);case 6:case\"end\":return _context.stop();}},_callee);}));return function fetchData(){return _ref.apply(this,arguments);};}();catchErrors(fetchData());},[id]);// When tracksData updates, compile arrays of tracks and audioFeatures\nuseEffect(function(){if(!tracksData){return;}// When tracksData updates, check if there are more tracks to fetch\n// then update the state variable\nvar fetchMoreData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _yield$axios$get,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!tracksData.next){_context2.next=6;break;}_context2.next=3;return axios.get(tracksData.next);case 3:_yield$axios$get=_context2.sent;data=_yield$axios$get.data;setTracksData(data);case 6:case\"end\":return _context2.stop();}},_callee2);}));return function fetchMoreData(){return _ref2.apply(this,arguments);};}();setTracks(function(tracks){return[].concat(_toConsumableArray(tracks?tracks:[]),_toConsumableArray(tracksData.items));});catchErrors(fetchMoreData());// Also update the audioFeatures state variable using the track IDs\nvar fetchAudioFeatures=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var ids,_yield$getAudioFeatur,data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:ids=tracksData.items.map(function(_ref4){var track=_ref4.track;return track.id;}).join(',');_context3.next=3;return getAudioFeaturesForTracks(ids);case 3:_yield$getAudioFeatur=_context3.sent;data=_yield$getAudioFeatur.data;setAudioFeatures(function(audioFeatures){return[].concat(_toConsumableArray(audioFeatures?audioFeatures:[]),_toConsumableArray(data['audio_features']));});case 6:case\"end\":return _context3.stop();}},_callee3);}));return function fetchAudioFeatures(){return _ref3.apply(this,arguments);};}();catchErrors(fetchAudioFeatures());},[tracksData]);// Map over tracks and add audio_features property to each track\nvar tracksWithAudioFeatures=useMemo(function(){if(!tracks||!audioFeatures){return null;}return tracks.map(function(_ref5){var track=_ref5.track;var trackToAdd=track;if(!track.audio_features){var audioFeaturesObj=audioFeatures.find(function(item){if(!item||!track){return null;}return item.id===track.id;});trackToAdd['audio_features']=audioFeaturesObj;}return trackToAdd;});},[tracks,audioFeatures]);// Sort tracks by audio feature to be used in template\nvar sortedTracks=useMemo(function(){if(!tracksWithAudioFeatures){return null;}return _toConsumableArray(tracksWithAudioFeatures).sort(function(a,b){var aFeatures=a['audio_features'];var bFeatures=b['audio_features'];if(!aFeatures||!bFeatures){return false;}return bFeatures[sortValue]-aFeatures[sortValue];});},[sortValue,tracksWithAudioFeatures]);return/*#__PURE__*/_jsx(_Fragment,{children:playlist?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(StyledHeader,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"header__inner\",children:[playlist.images.length&&playlist.images[0].url&&/*#__PURE__*/_jsx(\"img\",{className:\"header__img\",src:playlist.images[0].url,alt:\"Playlist Artwork\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"header__overline\",children:\"Playlist\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"header__name\",children:playlist.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"header__meta\",children:[playlist.followers.total?/*#__PURE__*/_jsxs(\"span\",{children:[playlist.followers.total,\" \",\"follower\".concat(playlist.followers.total!==1?'s':'')]}):null,/*#__PURE__*/_jsxs(\"span\",{children:[playlist.tracks.total,\" \",\"song\".concat(playlist.tracks.total!==1?'s':'')]})]})]})]})}),/*#__PURE__*/_jsx(\"main\",{children:/*#__PURE__*/_jsxs(SectionWrapper,{title:\"Playlist\",breadcrumb:true,children:[/*#__PURE__*/_jsxs(StyledDropdown,{active:!!sortValue,children:[/*#__PURE__*/_jsx(\"label\",{className:\"sr-only\",htmlFor:\"order-select\",children:\"Sort tracks\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"track-order\",id:\"order-select\",onChange:function onChange(e){return setSortValue(e.target.value);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Sort tracks\"}),sortOptions.map(function(option,i){return/*#__PURE__*/_jsx(\"option\",{value:option,children:\"\".concat(option.charAt(0).toUpperCase()).concat(option.slice(1))},i);})]})]}),sortedTracks&&/*#__PURE__*/_jsx(TrackList,{tracks:sortedTracks})]})})]}):/*#__PURE__*/_jsx(Loader,{})});};export default Playlist;","map":{"version":3,"names":["useState","useEffect","useMemo","useParams","axios","catchErrors","getPlaylistById","getAudioFeaturesForTracks","TrackList","SectionWrapper","Loader","StyledHeader","StyledDropdown","Playlist","id","playlist","setPlaylist","tracksData","setTracksData","tracks","setTracks","audioFeatures","setAudioFeatures","sortValue","setSortValue","sortOptions","fetchData","data","fetchMoreData","next","get","items","fetchAudioFeatures","ids","map","track","join","tracksWithAudioFeatures","trackToAdd","audio_features","audioFeaturesObj","find","item","sortedTracks","sort","a","b","aFeatures","bFeatures","images","length","url","name","followers","total","e","target","value","option","i","charAt","toUpperCase","slice"],"sources":["D:/Andrew/Documents/GitHub/SpotifyApp/client/src/pages/Playlist.js"],"sourcesContent":["import { useState, useEffect, useMemo } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { catchErrors } from '../utils'\r\nimport { getPlaylistById, getAudioFeaturesForTracks } from '../Spotify';\r\nimport { TrackList, SectionWrapper, Loader } from '../components';\r\nimport { StyledHeader, StyledDropdown } from '../styles';\r\n\r\nconst Playlist = () => {\r\n  const { id } = useParams();\r\n  const [playlist, setPlaylist] = useState(null);\r\n  const [tracksData, setTracksData] = useState(null);\r\n  const [tracks, setTracks] = useState(null);\r\n  const [audioFeatures, setAudioFeatures] = useState(null);\r\n  const [sortValue, setSortValue] = useState('');\r\n  const sortOptions = ['danceability', 'tempo', 'energy'];\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      const { data } = await getPlaylistById(id);\r\n      setPlaylist(data);\r\n      setTracksData(data.tracks);\r\n    };\r\n\r\n    catchErrors(fetchData());\r\n  }, [id]);\r\n\r\n  // When tracksData updates, compile arrays of tracks and audioFeatures\r\n  useEffect(() => {\r\n    if (!tracksData) {\r\n      return;\r\n    }\r\n\r\n    // When tracksData updates, check if there are more tracks to fetch\r\n    // then update the state variable\r\n    const fetchMoreData = async () => {\r\n      if (tracksData.next) {\r\n        const { data } = await axios.get(tracksData.next);\r\n        setTracksData(data);\r\n      }\r\n    };\r\n\r\n    setTracks(tracks => ([\r\n      ...tracks ? tracks : [],\r\n      ...tracksData.items\r\n    ]));\r\n\r\n    catchErrors(fetchMoreData());\r\n\r\n    // Also update the audioFeatures state variable using the track IDs\r\n    const fetchAudioFeatures = async () => {\r\n        const ids = tracksData.items.map(({ track }) => track.id).join(',');\r\n        const { data } = await getAudioFeaturesForTracks(ids);\r\n        setAudioFeatures(audioFeatures => ([\r\n          ...audioFeatures ? audioFeatures : [],\r\n          ...data['audio_features']\r\n        ]));\r\n      };\r\n      catchErrors(fetchAudioFeatures());\r\n\r\n  }, [tracksData]);\r\n\r\n  // Map over tracks and add audio_features property to each track\r\n  const tracksWithAudioFeatures = useMemo(() => {\r\n    if (!tracks || !audioFeatures) {\r\n      return null;\r\n    }\r\n\r\n    return tracks.map(({ track }) => {\r\n      const trackToAdd = track;\r\n\r\n      if (!track.audio_features) {\r\n        const audioFeaturesObj = audioFeatures.find(item => {\r\n          if (!item || !track) {\r\n            return null;\r\n          }\r\n          return item.id === track.id;\r\n        });\r\n\r\n        trackToAdd['audio_features'] = audioFeaturesObj;\r\n      }\r\n\r\n      return trackToAdd;\r\n    });\r\n  }, [tracks, audioFeatures]);\r\n\r\n  // Sort tracks by audio feature to be used in template\r\n  const sortedTracks = useMemo(() => {\r\n    if (!tracksWithAudioFeatures) {\r\n      return null;\r\n    }\r\n\r\n    return [...tracksWithAudioFeatures].sort((a, b) => {\r\n      const aFeatures = a['audio_features'];\r\n      const bFeatures = b['audio_features'];\r\n\r\n      if (!aFeatures || !bFeatures) {\r\n        return false;\r\n      }\r\n\r\n      return bFeatures[sortValue] - aFeatures[sortValue];\r\n    });\r\n  }, [sortValue, tracksWithAudioFeatures]);\r\n\r\n  return (\r\n    <>\r\n      {playlist ? (\r\n        <>\r\n          <StyledHeader>\r\n            <div className=\"header__inner\">\r\n              {playlist.images.length && playlist.images[0].url && (\r\n                <img className=\"header__img\" src={playlist.images[0].url} alt=\"Playlist Artwork\"/>\r\n              )}\r\n              <div>\r\n                <div className=\"header__overline\">Playlist</div>\r\n                <h1 className=\"header__name\">{playlist.name}</h1>\r\n                <p className=\"header__meta\">\r\n                  {playlist.followers.total ? (\r\n                    <span>{playlist.followers.total} {`follower${playlist.followers.total !== 1 ? 's' : ''}`}</span>\r\n                  ) : null}\r\n                  <span>{playlist.tracks.total} {`song${playlist.tracks.total !== 1 ? 's' : ''}`}</span>\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </StyledHeader>\r\n\r\n          <main>\r\n            <SectionWrapper title=\"Playlist\" breadcrumb={true}>\r\n            <StyledDropdown active={!!sortValue}>\r\n                <label className=\"sr-only\" htmlFor=\"order-select\">Sort tracks</label>\r\n                <select\r\n                  name=\"track-order\"\r\n                  id=\"order-select\"\r\n                  onChange={e => setSortValue(e.target.value)}\r\n                  >\r\n                  <option value=\"\">Sort tracks</option>\r\n                  {sortOptions.map((option, i) => (\r\n                    <option value={option} key={i}>\r\n                      {`${option.charAt(0).toUpperCase()}${option.slice(1)}`}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </StyledDropdown>\r\n              {sortedTracks && (\r\n                <TrackList tracks={sortedTracks} />\r\n              )}\r\n            </SectionWrapper>\r\n          </main>\r\n        </>\r\n      ) : (\r\n        <Loader />\r\n      )}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Playlist;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}